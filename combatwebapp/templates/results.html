{% extends "base.html" %}
{% block css %}
    <style type="text/css">
        #ppibox {
            width: 100%;
            height: 800px;
            border-style: solid;
            border-width: 2px;
        }
    </style>
{% endblock %}
{% block content %}
    {% if gene %}
        <div class="section">
            <h5>Showing results for {{ gene.name }}</h5><br>
            <iframe src="http://thoba.sanbi.ac.za:8080/?loc=NC_000962.3%3A{{ location }}&tracks=DNA%2CGenes&highlight="
                    frameborder="0"
                    scrolling="no" width="100%" height="450">
            </iframe>
        </div>
        <div class="divider"></div>
        <div class="section">
            {#        {{ gene }} {{ name }}#}
            <div class="row">
                <div class="col s12">
                    <ul class="tabs ">
                        <li class="tab col s3"><a class="light-blue-text text-darken-4 active" href="#gi">General
                            annotation</a>
                        </li>
                        <li class="tab col s3"><a class="light-blue-text text-darken-4" href="#coords">Coordinates</a>
                        </li>
                        <li class="tab col s3"><a class="light-blue-text text-darken-4"
                                                  href="#orth">Cross-references</a>
                        </li>
                        <!--                        <li class="tab col s3"><a class="light-blue-text text-darken-4" href="#actor">Interaction</a>
                                                </li>-->
                        <li class="tab col s3"><a class="light-blue-text text-darken-4" href="#ppi">Interactions</a>
                        </li>
                        <li class="tab col s3"><a class="light-blue-text text-darken-4" href="#str">Structural
                            Information</a>
                        </li>
                    </ul>
                </div>
                <div id="gi" class="col s12">
                    <table class="bordered">
                        <tbody>
                        <tr>
                            <th>Gene name</th>
                            <td>{{ gene.name }}</td>
                        </tr>
                        <tr>
                            <th>Preferred name</th>
                            <td>{{ gene.preffered_name or '' }}</td>
                        </tr>
                        <tr>
                            <th>Rv number</th>
                            <td>{{ gene.uniquename[5:] or gene.name }}</td>
                        </tr>
                        <tr></tr>
                        <tr>
                            <th>Type</th>
                            <td>{{ gene.coding or gene.biotype }}</td>
                        </tr>
                        <tr>
                            <th>Function</th>
                            {% if protein.function %}
                                <td>{{ protein.function[9:] }}</td>
                            {% else %}
                                <td>Function unknown</td>
                            {% endif %}
                        </tr>
                        <tr>
                            <th>Product</th>
                            <td>{{ gene.description }}</td>
                        </tr>
                        <tr>
                            <th>Family</th>
                            <td>{{ protein.family }}</td>
                        </tr>
                        <tr>
                            <th>Molecular mass</th>
                            <td>{{ protein.mass }}</td>
                        </tr>
                        <tr>
                            <td><b>Protein length</b></td>
                            <td>{{ protein.seqlen }}</td>
                        </tr>
                        </tbody>
                    </table>
                    {% if citation %}
                        <ul class="collection with-header">
                            <li class="collection-header"><h5>Publications</h5></li>
                            {% for entry in citation %}
                                {#                                    <a>{{ entry }}</a>#}
                                {#                                            <a target="_blank"#}
                                {#                                               href="http://www.ncbi.nlm.nih.gov/pubmed/?term={{ entry.pubmed_id }}">{{ entry.title }}</a>#}
                                {#                                            <br>#}
                                <li class="collection-item">
                                    <span class="title">{{ entry.title }}</span><br>
                                    {{ authors.get(entry.pubmed_id, '') }}
                                    {#                                    {% for author in authors.get(entry.pubmed_id, '') %}#}
                                    {#                                        {{ author }}#}
                                    {#                                    {% endfor %}#}
                                    <p>{{ entry.source }}<br>{{ entry.journal }}<br>
                                        [<a target="_blank"
                                            href="http://www.ncbi.nlm.nih.gov/pubmed/?term={{ entry.pubmed_id }}">PubMed</a>]
                                    </p>
                                    {#                                                <a href="#!" class="secondary-content"><i#}
                                    {#                                                        class="material-icons">grade</i></a>#}
                                </li>
                            {% endfor %}

                        </ul>
                    {% else %}
                        {{ '' }}
                    {% endif %}
                </div>
                <div id="coords" class="col s12">
                    <table class="bordered">
                        <thead>
                        <tr>
                            <th data-field="coding">Type</th>
                            <th data-field="start">Start</th>
                            <th data-field="end">End</th>
                            <th data-field="strand">Strand</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr>
                            <td>{{ gene.coding or pseudogene }}</td>
                            <td>{{ loc.fmin }}</td>
                            <td>{{ loc.fmax }}</td>
                            <td>{{ loc.strand }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div id="orth" class="col s12">
                    <table class="bordered">
                        <tbody>
                        {#                        <tr>#}
                        {#                            <th>CDC1551</th>#}
                        {#                            <td>{{ ortholog_name or '' }}</td>#}
                        {#                        </tr>#}
                        <tr>
                            <th>UniProt</th>
                            <td>
                                <a target="_blank"
                                   href="http://www.uniprot.org/uniprot/{{ gene.uniprot_entry or gene.gene_id }}">{{ gene.uniprot_entry or gene.gene_id }}</a>
                            </td>
                        </tr>
                        <tr>
                            <th>GenBank</th>
                            <td>
                                <a target="_blank"
                                   href="http://www.ncbi.nlm.nih.gov/protein/{{ protein.ensembl_id or gene.uniquename[5:] }}">{{ protein.ensembl_id or gene.uniquename[5:] }}</a>
                            </td>
                        </tr>
                        <tr>
                            <th>EnsemblBacteria</th>
                            <td>
                                <a target="_blank"
                                   href="http://bacteria.ensembl.org/Mycobacterium_tuberculosis_h37rv/Gene/Summary?t={{ protein.ensembl_id or gene.uniquename[5:] }}">{{ protein.ensembl_id or gene.uniquename[5:] }}</a>
                            </td>
                        </tr>
                        <tr>
                            <th>TubercuList</th>
                            <td>
                                <a target="_blank"
                                   href="http://tuberculist.epfl.ch/quicksearch.php?gene+name={{ gene.uniquename[5:] or gene.name }}">{{ gene.uniquename[5:] or gene.name }}</a>
                            </td>
                        </tr>
                        <tr>
                            <th>GO</th>
                            <td>
                                {% for entry in go_terms %}
                                    <a target="_blank"
                                       href="http://amigo.geneontology.org/amigo/term/{{ entry.name }}">{{ entry.definition }}</a>
                                    <br>
                                {% endfor %}
                            </td>
                            {#                            <td>{{ go_terms }}</td>#}
                        <tr>
                            <th>InterPro</th>
                            <td>
                                {% for entry in inter_pro %}
                                    <a target="_blank"
                                       href="https://www.ebi.ac.uk/interpro/entry/{{ entry }}">{{ entry }} </a><br>
                                {% endfor %}
                            </td>
                            {#                            <td>{{ inter_pro }}</td>#}
                        </tr>
                        </tbody>
                    </table>
                </div>
                <!--                <div id="actor" class="col s12">
                    <table class="bordered">
                        <tbody>
                        <tr>
                            <th>MTB</th>
                            <td>
                                {% if interactor %}
                                    {% for actor in interactor %}
                                        <a target="_blank"
                                           href="http://www.uniprot.org/uniprot/{{ actor }}">{{ actor }}</a><br>

                                    {% endfor %}
                                {% else %}
                                    <p></p>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>Human</th>
                            <td>
                                {% if interactor %}
                                    {% for actor in h_interact %}
                                        <a target="_blank"
                                           href="http://www.uniprot.org/uniprot/{{ actor }}">{{ actor }}</a><br>
                                    {% endfor %}
                                {% else %}
                                    <p></p>
                                {% endif %}
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>-->
                <div id="ppi" class="col s12">
                    <button id="button" class="btn waves-effect waves-light light-blue darken-4">Draw
                        Graph
                    </button>
                    <div id="ppibox">click the button to draw the graph</div>
                </div>
                <div id="str" class="col s12">
                    {#                    <table class="bordered">#}
                    {#                        <tbody>#}
                    {#                        <th>Structural Information</th>#}
                    {#                        <td>#}
                    {#                            {% if protein %}#}
                    {#                            {% for entry in pdb_ids %}#}
                    {#                                    <a>{{ entry }}</a>#}
                    {#                                <a target="_blank"#}
                    {#                                   href="http://www.rcsb.org/pdb/explore/explore.do?pdbId={{ entry }}">{{ entry }}</a>#}
                    {#                                <br>#}
                    {#                            {% endfor %}#}
                    {#                        <div class="hide" id="pdb_id">{{ pdb_ids[0] }}</div>#}
                    {#                            {% else %}#}
                    {#                                {{ '' }}#}
                    {#                            {% endif %}#}
                    {#                        </td>#}
                    {#                        </tbody>#}
                    {#                    </table>#}
                    <br>
                    <div class="row">
                        <div class="col s6">
                            <div id='picked-atom-name' style='text-align:center;'>&nbsp;</div>
                            <div class="center-align" id=viewer></div>
                        </div>
                        <div class="col s6">
                            <ul class="collection with-header">
                                <li class="collection-header"><h6>PBD ID</h6></li>
                                {% for entry in pdb_ids %}
                                    <div class="hide" id="pdb_id">{{ pdb_ids[0] }}</div>
                                    <li class="collection-item">
                                        <a target="_blank"
                                           href="http://www.rcsb.org/pdb/explore/explore.do?pdbId={{ entry }}">{{ entry }}</a>
                                        <br>
                                    </li>
                                {% endfor %}

                            </ul>
                        </div>
                    </div>
                    <div class="divider"></div>
                    {#                    <div class="section center-align">#}
                    {#                        <div id='picked-atom-name' style='text-align:center;'>&nbsp;</div>#}
                    {#                        <div class="center-align" id=viewer></div>#}
                    {#                    </div>#}

                </div>
            </div>
        </div>
    {% else %}
        <div class="section">
            <h5>No Results</h5>
            <p>Could not find {{ term }}</p>
        </div>
    {% endif %}
{% endblock %}
{% block js %}
    <script src="{{ url_for('static', filename='js/p_viewer.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/cytoscape.min.js') }}"></script>
    <script type="text/javascript">
        window.drawgraph = function () {
            $.ajax({
                url: '{{ url_for('.ppi_data', locus_tag=gene.locus_tag or '') }}',
                dataType: 'json',
                cache: false,
                success: function (results) {
                    var cy = window.cy = cytoscape({
                        container: document.getElementById('ppibox'),
                        layout: {
                            name: 'cose',
                            idealEdgeLength: 100,
                            nodeOverlap: 20
                        },
                        elements: results['elements'],
                        style: results['styles']
                    });
                }
            });
        };
        document.getElementById('button').onclick = function () {
            window.drawgraph();
        };
    </script>
{% endblock %}